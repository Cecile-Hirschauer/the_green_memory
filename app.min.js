document.addEventListener("DOMContentLoaded",()=>{const e=[{icon:"üåø",name:"Foug√®re"},{icon:"üçÑ",name:"Champignon"},{icon:"ü¶ä",name:"Renard"},{icon:"üêù",name:"Abeille"},{icon:"üêû",name:"Coccinelle"},{icon:"üåª",name:"Tournesol"},{icon:"üå≤",name:"Sapin"},{icon:"ü¶ã",name:"Papillon"}],t=document.getElementById("game-board"),n=document.getElementById("moves"),a=document.getElementById("live-feedback"),s=document.getElementById("restart-btn"),o=document.getElementById("game-message"),c=12;let d=[],i=[],r=0,l=0,m=!1,u=!1;const p=e=>{a.textContent=e},g=(e,t="",n=!0)=>{p(e),n&&(o.textContent=e,o.className="game-message"+(t?` ${t}`:""),o.hidden=!1)},h=()=>{o.hidden=!0,o.textContent="",o.className="game-message"},v=()=>{l=0,r=0,i=[],m=!1,u=!1,n.textContent="0/12 coups",t.innerHTML="",h(),p("Nouvelle partie commenc√©e. √Ä vous de jouer !"),d=(e=>{for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e})([...e,...e]);const a=document.createDocumentFragment();d.forEach((e,t)=>{const n=document.createElement("li"),s=document.createElement("button");s.type="button",s.classList.add("card"),s.dataset.name=e.name,s.dataset.index=t,s.setAttribute("aria-label",`Carte ${t+1}, masqu√©e`),s.innerHTML=`\n                <div class="card-inner">\n                    <span class="card-front" aria-hidden="true">?</span>\n                    <span class="card-back" aria-hidden="true">${e.icon}</span>\n                </div>\n            `,s.addEventListener("click",()=>b(s,e)),n.appendChild(s),a.appendChild(n)}),t.appendChild(a)},b=(e,t)=>{u||m||e.classList.contains("flipped")||e.classList.contains("matched")||(f(e,t),2===i.length&&((()=>{l++;const e=c-l;n.textContent=`${l}/12 coups`,5===e?p("Attention, il ne vous reste que 5 coups !"):3===e?p("Attention, plus que 3 coups !"):1===e&&p("Dernier coup !")})(),E()))},f=(e,t)=>{e.classList.add("flipped"),e.setAttribute("aria-label",`Carte ${parseInt(e.dataset.index,10)+1}, ${t.name}`),i.push({element:e,name:t.name})},E=()=>{m=!0;const[t,n]=i;t.name===n.name?L(t,n):$(t,n),l>=c&&r<e.length&&C()},C=()=>{u=!0,document.querySelectorAll(".card:not(.matched)").forEach(e=>{e.setAttribute("aria-disabled","true")}),setTimeout(()=>{g("Dommage ! Vous avez utilis√© vos 12 coups.","lose"),s.focus()},1200)},L=(t,n)=>{t.element.classList.add("matched"),n.element.classList.add("matched"),r++,g("Paire trouv√©e !","win"),y(),r===e.length?(u=!0,document.querySelectorAll(".card").forEach(e=>{e.setAttribute("aria-disabled","true")}),setTimeout(()=>{g(`Bravo, vous avez gagn√© en ${l} coups !`,"win"),s.focus()},500)):setTimeout(()=>{(()=>{if(e.length-r>0){const t=c-l;p(`${r} paire${r>1?"s":""} trouv√©e${r>1?"s":""} sur ${e.length}. Il vous reste ${t} coup${t>1?"s":""}.`)}})()},1500)},$=(e,t)=>{g("Pas de correspondance, essayez encore.","lose"),setTimeout(()=>{e.element.classList.remove("flipped"),t.element.classList.remove("flipped"),e.element.setAttribute("aria-label",`Carte ${parseInt(e.element.dataset.index,10)+1}, masqu√©e`),t.element.setAttribute("aria-label",`Carte ${parseInt(t.element.dataset.index,10)+1}, masqu√©e`),h(),y(),e.element.focus()},1e3)},y=()=>{i=[],m=!1};s.addEventListener("click",v),v(),window.addEventListener("load",()=>{if(window.performance){const e=performance.getEntriesByType("resource").reduce((e,t)=>e+(t.transferSize||0),0)+new Blob([document.documentElement.outerHTML]).size,t=document.getElementById("page-weight");t&&e>0&&(t.textContent=(e/1024).toFixed(1)+" Ko")}})});